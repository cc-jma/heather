#!/bin/sh

# Get the remote branch name (usually origin/main or origin/master)
remote="$1"
url="$2"

# Check what's being pushed - compare with main branch
if git diff --name-only origin/main...HEAD 2>/dev/null | grep -q "^frontend/" || 
   git diff --name-only main...HEAD 2>/dev/null | grep -q "^frontend/"; then
  echo "Running frontend validation before push..."
  cd frontend && npm run validate
  if [ $? -ne 0 ]; then
    echo "Frontend validation failed"
    exit 1
  fi
  cd ..
fi

if git diff --name-only origin/main...HEAD 2>/dev/null | grep -q "^backend/" ||
   git diff --name-only main...HEAD 2>/dev/null | grep -q "^backend/"; then
  echo "Running backend validation before push..."
  cd backend && ./gradlew build
  if [ $? -ne 0 ]; then
    echo "Backend build failed"
    exit 1
  fi
  cd ..
fi